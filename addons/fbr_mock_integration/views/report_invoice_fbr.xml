<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Inherit the standard customer invoice report -->
  <template id="report_invoice_document_inherit_fbr" inherit_id="account.report_invoice_document">
    <!-- Append our tight FBR block at the very end of the page -->
    <xpath expr="(//div[contains(concat(' ', normalize-space(@class), ' '), ' page ')])[last()]" position="inside">

      <!-- Show only if QR exists -->
      <t t-if="o.fbr_qr_png">
        <table style="margin-top:10px; border-collapse:collapse; border-spacing:0;">
          <tr>
            <!-- Left: FBR DI Logo -->
            <td style="vertical-align:middle;">
              <img t-att-src="'/fbr_mock_integration/static/img/fbr_di_logo.png'"
                   alt=""
                   style="height:1in; width:auto;"/>
            </td>

            <!-- Right: QR Code, with a tiny gap from logo -->
            <td style="vertical-align:middle; padding-left:6px;">
              <img t-att-src="image_data_uri(o.fbr_qr_png)"
                   alt=""
                   style="height:1in; width:1in;"/>
            </td>
          </tr>

          <!-- Centered label+number below BOTH -->
          <tr>
            <td colspan="2" style="text-align:center; padding-top:6px;">
              <div style="font-size:11px; line-height:1.2;">
                <strong>FBR Invoice Number:</strong>
                <t t-esc="o.fbr_invoice_number or '-'"/>
              </div>
            </td>
          </tr>
        </table>
      </t>

    </xpath>
  </template>
</odoo>
