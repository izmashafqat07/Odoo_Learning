<odoo>
  <record id="view_users_form_inherit_ums_partner_ctx" model="ir.ui.view">
    <field name="name">res.users.form.inherit.ums.partner.ctx</field>
    <field name="model">res.users</field>
    <field name="inherit_id" ref="base.view_users_form"/>
    <field name="arch" type="xml">

      <!-- partner_id ko prefill + lock + correct form_view_ref -->
      <xpath expr="//field[@name='partner_id']" position="attributes">
        <!-- Sirf is partner ko allow karo -->
        <attribute name="domain">[('id','=', context.get('force_partner_id'))]</attribute>

        <!-- Naya partner create/quick create band -->
        <attribute name="options">{'no_create': True, 'no_create_edit': True}</attribute>

        <!-- Jab open karein to hamara custom partner form hi khule -->
        <attribute name="context">
          {
            'form_view_ref': 'UMS_System.view_university_partner_form',
            'default_id': context.get('force_partner_id'),
            'default_partner_type': False
          }
        </attribute>
      </xpath>

      <!-- (optional) partner_id required kar dein taa-ke galti se blank na rahe -->
      <xpath expr="//field[@name='partner_id']" position="replace">
        <field name="partner_id"
               domain="[('id','=', context.get('force_partner_id'))]"
               options="{'no_create': True, 'no_create_edit': True}"
               context="{'form_view_ref': 'UMS_System.view_university_partner_form',
                         'default_id': context.get('force_partner_id'),
                         'default_partner_type': False}"
               required="1"/>
      </xpath>

    </field>
  </record>
</odoo>
